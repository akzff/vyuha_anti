<!-- Trade Form Modal Component -->
<div id="trade-form-modal" class="modal-overlay" style="display: none;">
    <div class="modal-container">

        <!-- Modal Header -->
        <div class="modal-header">
            <div class="modal-title-section">
                <div class="modal-icon">
                    <i class="fa-solid fa-pen-nib"></i>
                </div>
                <div>
                    <h2 class="modal-title">Log Your Trade</h2>
                    <p class="modal-subtitle">Every trade is a lesson. Record it accurately.</p>
                </div>
            </div>

            <!-- Trade Type Toggle -->
            <div class="trade-type-toggle">
                <button class="toggle-btn active" data-type="live">
                    <i class="fa-solid fa-bolt"></i> Live Entry
                </button>
                <button class="toggle-btn" data-type="past">
                    <i class="fa-solid fa-clock-rotate-left"></i> Log Past
                </button>
            </div>

            <button class="modal-close-btn" onclick="closeTradeFormModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <!-- Modal Body -->
        <div class="modal-body">
            <form id="trade-form" onsubmit="handleTradeFormSubmit(event)">

                <!-- Row 1: Symbol, Side, Entry Date, Exchange -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Symbol</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-coins input-icon"></i>
                            <input type="text" id="trade-symbol" class="form-input" placeholder="e.g., BTC, ETH"
                                required autocomplete="off" />
                        </div>
                        <div id="symbol-suggestions" class="suggestions-dropdown" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Position</label>
                        <div class="side-toggle">
                            <button type="button" class="side-btn long active" data-side="LONG">
                                <i class="fa-solid fa-arrow-up"></i> Long
                            </button>
                            <button type="button" class="side-btn short" data-side="SHORT">
                                <i class="fa-solid fa-arrow-down"></i> Short
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Entry Date & Time</label>
                        <div class="input-wrapper">
                            <i class="fa-regular fa-calendar input-icon"></i>
                            <input type="datetime-local" id="trade-entry-date" class="form-input datetime-input"
                                required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Exchange</label>
                        <div class="input-wrapper">
                            <select id="trade-exchange" class="form-input form-select">
                                <option value="Binance">Binance</option>
                                <option value="Coinbase">Coinbase</option>
                                <option value="Kraken">Kraken</option>
                                <option value="Bybit">Bybit</option>
                                <option value="OKX">OKX</option>
                                <option value="Other">Other</option>
                            </select>
                            <i class="fa-solid fa-chevron-down select-arrow"></i>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Strategy, Entry Price, Capital, Leverage -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Strategy</label>
                        <div class="input-wrapper">
                            <select id="trade-strategy" class="form-input form-select">
                                <option value="">Select Strategy</option>
                                <option value="Momentum Master">Momentum Master</option>
                                <option value="Supply & Demand">Supply & Demand</option>
                                <option value="Breakout Hunter">Breakout Hunter</option>
                                <option value="Reversal Edge">Reversal Edge</option>
                                <option value="Trend Following">Trend Following</option>
                                <option value="Discretionary">Discretionary</option>
                            </select>
                            <i class="fa-solid fa-chevron-down select-arrow"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Entry Price</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-dollar-sign input-icon"></i>
                            <input type="number" id="trade-entry-price" class="form-input" placeholder="0.00"
                                step="0.01" required />
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Capital (USD)</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-wallet input-icon"></i>
                            <input type="number" id="trade-capital" class="form-input" placeholder="0.00" step="0.01"
                                required />
                        </div>
                        <div class="quick-actions">
                            <button type="button" class="quick-btn" onclick="setCapitalPercent(25)">25%</button>
                            <button type="button" class="quick-btn" onclick="setCapitalPercent(50)">50%</button>
                            <button type="button" class="quick-btn" onclick="setCapitalPercent(75)">75%</button>
                            <button type="button" class="quick-btn" onclick="setCapitalPercent(100)">100%</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Leverage</label>
                        <div class="input-wrapper">
                            <input type="number" id="trade-leverage" class="form-input" value="1" min="1" max="100" />
                            <span class="input-suffix">x</span>
                        </div>
                        <div class="quick-actions">
                            <button type="button" class="quick-btn" onclick="setLeverage(1)">1x</button>
                            <button type="button" class="quick-btn" onclick="setLeverage(5)">5x</button>
                            <button type="button" class="quick-btn" onclick="setLeverage(10)">10x</button>
                            <button type="button" class="quick-btn" onclick="setLeverage(25)">25x</button>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Stop Loss & Take Profit -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Stop Loss</label>
                        <div class="dual-input">
                            <div class="input-wrapper flex-1">
                                <i class="fa-solid fa-shield-halved input-icon text-red"></i>
                                <input type="number" id="trade-stop-loss" class="form-input" placeholder="Price"
                                    step="0.01" />
                            </div>
                            <div class="input-wrapper percent-input">
                                <input type="number" id="sl-percent" class="form-input" placeholder="%" step="0.1" />
                                <span class="input-suffix">%</span>
                            </div>
                        </div>
                        <div class="quick-actions">
                            <button type="button" class="quick-btn danger" onclick="setSLPercent(1)">1%</button>
                            <button type="button" class="quick-btn danger" onclick="setSLPercent(2)">2%</button>
                            <button type="button" class="quick-btn danger" onclick="setSLPercent(5)">5%</button>
                            <button type="button" class="quick-btn danger" onclick="setSLPercent(10)">10%</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Take Profit</label>
                        <div class="dual-input">
                            <div class="input-wrapper flex-1">
                                <i class="fa-solid fa-bullseye input-icon text-green"></i>
                                <input type="number" id="trade-take-profit" class="form-input" placeholder="Price"
                                    step="0.01" />
                            </div>
                            <div class="input-wrapper percent-input">
                                <input type="number" id="tp-percent" class="form-input" placeholder="%" step="0.1" />
                                <span class="input-suffix">%</span>
                            </div>
                        </div>
                        <div class="quick-actions">
                            <button type="button" class="quick-btn success" onclick="setTPPercent(2)">2%</button>
                            <button type="button" class="quick-btn success" onclick="setTPPercent(5)">5%</button>
                            <button type="button" class="quick-btn success" onclick="setTPPercent(10)">10%</button>
                            <button type="button" class="quick-btn success" onclick="setTPPercent(20)">20%</button>
                        </div>
                    </div>
                </div>

                <!-- Exit Fields (Only for Past Trades) -->
                <div id="exit-fields" class="exit-section" style="display: none;">
                    <div class="section-divider">
                        <span class="divider-text">Exit Information</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Exit Price</label>
                            <div class="input-wrapper">
                                <i class="fa-solid fa-dollar-sign input-icon"></i>
                                <input type="number" id="trade-exit-price" class="form-input" placeholder="0.00"
                                    step="0.01" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Exit Date & Time</label>
                            <div class="input-wrapper">
                                <i class="fa-regular fa-calendar input-icon"></i>
                                <input type="datetime-local" id="trade-exit-date" class="form-input datetime-input" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Exit Quality</label>
                            <div class="star-rating">
                                <i class="fa-star far" data-rating="1"></i>
                                <i class="fa-star far" data-rating="2"></i>
                                <i class="fa-star far" data-rating="3"></i>
                                <i class="fa-star far" data-rating="4"></i>
                                <i class="fa-star far" data-rating="5"></i>
                            </div>
                            <div class="rating-text">Rate your exit execution</div>
                        </div>
                    </div>
                </div>

                <!-- Metrics Display -->
                <div class="metrics-panel">
                    <div class="metric-card">
                        <div class="metric-label">Position Size</div>
                        <div class="metric-value" id="calc-position-size">$0.00</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Quantity</div>
                        <div class="metric-value" id="calc-quantity">0.0000</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Risk/Reward</div>
                        <div class="metric-value" id="calc-rr">0.00</div>
                    </div>
                    <div class="metric-card" id="pnl-metric" style="display: none;">
                        <div class="metric-label">P&L</div>
                        <div class="metric-value" id="calc-pnl">$0.00</div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="fa-solid fa-note-sticky"></i> Notes
                    </label>
                    <textarea id="trade-notes" class="form-textarea" rows="3"
                        placeholder="Record your trade thesis, observations, and lessons learned..."></textarea>
                </div>

                <!-- Submit Button -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTradeFormModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        <i class="fa-solid fa-check"></i>
                        <span id="submit-text">Save Trade</span>
                    </button>
                </div>

            </form>
        </div>

    </div>
</div>